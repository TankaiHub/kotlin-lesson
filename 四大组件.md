# Activity
> è´Ÿè´£ç”¨æˆ·ç•Œé¢çš„å±•ç¤ºå’Œç”¨æˆ·äº¤äº’,å­¦ä¹ Activityå°±è¦å­¦ä¹ Fragmentï¼Œè™½ç„¶å®ƒä¸æ˜¯å››å¤§ç»„ä»¶ä¹‹ä¸€ï¼Œä½†æ˜¯å®ƒåœ¨æˆ‘ä»¬çš„å¼€å‘å·¥ä½œä¸­ä¹Ÿæ˜¯é¢‘é¢‘è¢«ä½¿ç”¨åˆ°ï¼Œä¸”å¿…é¡»å’ŒActivityä¸€å—ä½¿ç”¨ï¼Œå¸¸ç”¨äºåˆ†æ¨¡å—å¼€å‘ï¼Œæ¯”å¦‚æ…•è¯¾é¦–é¡µçš„å‡ ä¸ªtab,æ¯ä¸ªtabéƒ½æ˜¯å¯¹åº”ç€ä¸€ä¸ªFragment.
![android_activity_lifecycle](./imgs/android_activity_lifecycle.png)
## onCreate()
>è¯¥æ–¹æ³•ä¼šåœ¨ Activity ç¬¬ä¸€æ¬¡åˆ›å»ºæ—¶è¿›è¡Œè°ƒç”¨ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­é€šå¸¸ä¼šåš Activity åˆå§‹åŒ–ç›¸å…³çš„æ“ä½œï¼Œä¾‹å¦‚ï¼šåŠ è½½å¸ƒå±€ã€ç»‘å®šäº‹ä»¶ç­‰ã€‚

## onStart()
>è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ Activity ç”±ä¸å¯è§å˜ä¸ºå¯è§çš„æ—¶å€™è°ƒç”¨ï¼Œä½†æ˜¯è¿˜ä¸èƒ½å’Œç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚

## onResume()
>è¡¨ç¤ºActivityå·²ç»å¯åŠ¨å®Œæˆï¼Œè¿›å…¥åˆ°äº†å‰å°ï¼Œå¯ä»¥åŒç”¨æˆ·è¿›è¡Œäº¤äº’äº†ã€‚

## onPause()
>è¿™ä¸ªæ–¹æ³•åœ¨ç³»ç»Ÿå‡†å¤‡å»å¯åŠ¨å¦ä¸€ä¸ª Activity çš„æ—¶å€™è°ƒç”¨ã€‚å¯ä»¥åœ¨è¿™é‡Œé‡Šæ”¾ç³»ç»Ÿèµ„æºï¼ŒåŠ¨ç”»çš„åœæ­¢ï¼Œä¸å®œåœ¨æ­¤åšè€—æ—¶æ“ä½œã€‚

## onStop()
>å½“Activityä¸å¯è§çš„æ—¶å€™å›è°ƒæ­¤æ–¹æ³•ã€‚éœ€è¦åœ¨è¿™é‡Œé‡Šæ”¾å…¨éƒ¨ç”¨æˆ·ä½¿ç”¨ä¸åˆ°çš„èµ„æºã€‚å¯ä»¥åšè¾ƒé‡é‡çº§çš„å·¥ä½œï¼Œå¦‚å¯¹æ³¨å†Œå¹¿æ’­çš„è§£æ³¨å†Œï¼Œå¯¹ä¸€äº›çŠ¶æ€æ•°æ®çš„å­˜å‚¨ã€‚æ­¤æ—¶Activityè¿˜ä¸ä¼šè¢«é”€æ¯æ‰ï¼Œè€Œæ˜¯ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œä½†éšæ—¶éƒ½ä¼šè¢«å›æ”¶ã€‚é€šå¸¸å‘ç”Ÿåœ¨å¯åŠ¨å¦ä¸€ä¸ªActivityæˆ–åˆ‡æ¢åˆ°åå°æ—¶

## onDestroy()
>Activityå³å°†è¢«é”€æ¯ã€‚æ­¤æ—¶å¿…é¡»ä¸»åŠ¨é‡Šæ”¾æ‰æ‰€æœ‰å ç”¨çš„èµ„æºã€‚

## onRestart()
>è¿™ä¸ªæ–¹æ³•åœ¨ Activity ç”±åœæ­¢çŠ¶æ€å˜ä¸ºè¿è¡ŒçŠ¶æ€ä¹‹å‰è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ Activity è¢«é‡æ–°å¯åŠ¨äº†ï¼ˆAPPåˆ‡åˆ°åå°ä¼šè¿›å…¥onStop(), å†åˆ‡æ¢åˆ°å‰å°æ—¶ä¼šè§¦å‘onRestart()æ–¹æ³•ï¼‰
+ å››å¤§ç»„ä»¶éœ€è¦åœ¨AndroidManifestæ–‡ä»¶ä¸­é…ç½®å¦åˆ™æ— æ³•ä½¿ç”¨ï¼Œç±»ä¼¼Activityæ— æ³•å¯åŠ¨ï¼Œ
+ ä¸€èˆ¬æƒ…å†µä¸‹ï¼š åœ¨æ–°å»ºä¸€ä¸ªactivityåï¼Œä¸ºäº†ä½¿intentå¯ä»¥è°ƒç”¨æ­¤æ´»åŠ¨ï¼Œæˆ‘ä»¬è¦åœ¨androidManifest.xmlæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œæ ‡ç­¾çš„ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š
```xml
<activity
            android:name=".MainActivity"
            android:label="@string/app_name">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
  </activity>
```
+ android:nameæ˜¯å¯¹åº”Activityçš„ç±»åç§°
+ android:labelæ˜¯Activityæ ‡é¢˜æ æ˜¾ç¤ºçš„å†…å®¹. ç°å·²ä¸æ¨èä½¿ç”¨
+ æ˜¯æ„å›¾è¿‡æ»¤å™¨. å¸¸ç”¨è¯­éšå¼è·³è½¬
+ æ˜¯åŠ¨ä½œåç§°ï¼Œæ˜¯æŒ‡intentè¦æ‰§è¡Œçš„åŠ¨ä½œ
+ æ˜¯è¿‡æ»¤å™¨çš„ç±»åˆ« ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸ª ä¸­éƒ½è¦æ˜¾ç¤ºæŒ‡å®šä¸€ä¸ªé»˜è®¤çš„ç±»åˆ«åç§°ï¼Œå³<category android:name="android.intent.category.DEFAULT" />
+ å…¶ä¸­çš„æ˜¯"android.intent.action.MAIN"ï¼Œæ„æ€æ˜¯è¿™ä¸ªActivityæ˜¯åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥ä¸åŠ é»˜è®¤ç±»åˆ«åç§°ã€‚
## Activityå¯åŠ¨ä¸å‚æ•°ä¼ é€’
### 1. æ˜¾å¼å¯åŠ¨ï¼šé€šè¿‡åŒ…åæ¥å¯åŠ¨
- æœ€å¸¸è§çš„ï¼šstartActivity
```kotlin
//â‘ :å¸¸è§„è·³è½¬
val intent = Intent(MainActivity.this,SecondActivity.class)
startActivity(intent);

//â‘¡:æºå¸¦å‚æ•°å¯åŠ¨æ–°Activity
val intent = Intent(MainActivity.this,SecondActivity.class)
intent.putExtra("extra_data", "extra_data")
intent.putExtra("extra_int_data", 100)
startActivity(intent);
```
- æœŸå¾…ä»ç›®æ ‡é¡µè·å–æ•°æ®ï¼šstartActivityForResult---->æ¯”å¦‚å¯åŠ¨ç›¸å†Œè·å–å›¾ç‰‡
```kotlin
//â‘ å‡è®¾ä»A--->Bé¡µé¢ï¼Œä»¥startActivityForResultæ–¹å¼å¯åŠ¨
val intent = Intent(MainActivity.this, SecondActivity.class)
startActivityForResult(intent, 100);

//â‘¡å¦‚æœBé¡µé¢è¿”å›æ—¶ï¼Œè°ƒç”¨äº† 
setResult(Activity.RESULT_OK,resultIntent)
finish()

//â‘¢åˆ™Aé¡µé¢ä¼šå›è°ƒä¸‹é¢çš„æ–¹æ³•,åœ¨è¯¥å›è°ƒé‡Œå¯ä»¥æ‹¿åˆ°è¿”å›çš„æ•°æ®data
onActivityResult(requestCode: Int, resultCode: Int, data: Intent?)
```
### 2. éšå¼å¯åŠ¨
- éšå¼ Intent è¦æ¯”æ˜¾ç¤º Intent å«è“„çš„å¤šï¼Œä»–å¹¶ä¸æ˜ç¡®æŒ‡å®šè¦å¯åŠ¨å“ªä¸ª Activityï¼Œè€Œæ˜¯é€šè¿‡æŒ‡å®š action å’Œ category çš„ä¿¡æ¯ï¼Œè®©ç³»ç»Ÿå»åˆ†æè¿™ä¸ª Intentï¼Œå¹¶æ‰¾å‡ºåˆé€‚çš„ Activity å»å¯åŠ¨ã€‚
```xml
 <activity android:name=".SecondActivity">
     <intent-filter>
         <action android:name="com.example.firstapp.action.SecondActivity" />
         <category android:name="com.example.firstapp.category.SecondActivity" />
         <category android:name="android.intent.category.DEFAULT" /> // ä¸€å®šè¦æœ‰
     </intent-filter>
</activity>
```
```kotlin
val intent = Intent()
intent.setAction("com.example.firstapp.action.SecondActivity")
intent.setCategory("com.example.firstapp.category.SecondActivity")

intent.putExtra("extra_data", "extra_data")
intent.putExtra("extra_int_data", 100)
startActivity(intent);

startActivityForResult(intent,100);
```
## ç³»ç»Ÿç»™æˆ‘ä»¬æä¾›çš„ä¸€äº›å¸¸è§çš„Activtiy
### æ‹¨æ‰“ç”µè¯
```kotlin
//ç»™ç§»åŠ¨å®¢æœ10086æ‹¨æ‰“ç”µè¯
Uri uri = Uri.parse("tel:10086");
Intent intent = new Intent(Intent.ACTION_DIAL, uri);
startActivity(intent);
```
### å‘é€çŸ­ä¿¡
```kotlin
//ç»™10086å‘é€å†…å®¹ä¸ºâ€œHelloâ€çš„çŸ­ä¿¡ 
Uri uri = Uri.parse("smsto:10086");
Intent intent = new Intent(Intent.ACTION_SENDTO, uri);
intent.putExtra("sms_body", "Hello");
startActivity(intent);
```
### æ‰“å¼€æµè§ˆå™¨:
```kotlin
//æ‰“å¼€baiduä¸»é¡µ 
Uri uri = Uri.parse("http://www.baidu.com");
Intent intent  = new Intent(Intent.ACTION_VIEW, uri);
startActivity(intent);
```
### å¤šåª’ä½“æ’­æ”¾:
```kotlin
Intent intent = new Intent(Intent.ACTION_VIEW);
Uri uri = Uri.parse("file:///sdcard/foo.mp3");
intent.setDataAndType(uri, "audio/mp3");
startActivity(intent);
```
### æ‰“å¼€æ‘„åƒå¤´æ‹ç…§:
```kotlin
Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
startActivityForResult(intent, 0);

// åœ¨Activityçš„onActivityResultæ–¹æ³•å›è°ƒä¸­å–å‡ºç…§ç‰‡æ•°æ®
Bundle extras = intent.getExtras();
Bitmap bitmap = (Bitmap) extras.get("data");
```
### ä»å›¾åº“é€‰å›¾å¹¶å‰ªåˆ‡
```kotlin
// è·å–å¹¶å‰ªåˆ‡å›¾ç‰‡
Intent intent = new Intent(Intent.ACTION_GET_CONTENT);
intent.setType("image/*");
intent.putExtra("crop", "true"); // å¼€å¯å‰ªåˆ‡
intent.putExtra("aspectX", 1); // å‰ªåˆ‡çš„å®½é«˜æ¯”ä¸º1ï¼š2
intent.putExtra("aspectY", 2);
intent.putExtra("outputX", 20); // ä¿å­˜å›¾ç‰‡çš„å®½å’Œé«˜
intent.putExtra("outputY", 40);
intent.putExtra("output", Uri.fromFile(new File("/mnt/sdcard/temp"))); // ä¿å­˜è·¯å¾„
intent.putExtra("outputFormat", "JPEG");// è¿”å›æ ¼å¼
startActivityForResult(intent, 0);

//  åœ¨Activityçš„onActivityResultæ–¹æ³•ä¸­å»è¯»å–ä¿å­˜çš„æ–‡ä»¶
```
### å‰ªåˆ‡æŒ‡å®šå›¾ç‰‡æ–‡ä»¶
```kotlin
Intent intent = new Intent("com.android.camera.action.CROP");
intent.setClassName("com.android.camera", "com.android.camera.CropImage");
intent.setData(Uri.fromFile(new File("/mnt/sdcard/temp")));
intent.putExtra("outputX", 1); // å‰ªåˆ‡çš„å®½é«˜æ¯”ä¸º1ï¼š2
intent.putExtra("outputY", 2);
intent.putExtra("aspectX", 20); // ä¿å­˜å›¾ç‰‡çš„å®½å’Œé«˜
intent.putExtra("aspectY", 40);
intent.putExtra("scale", true);
intent.putExtra("noFaceDetection", true);
intent.putExtra("output", Uri.parse("file:///mnt/sdcard/temp"));
startActivityForResult(intent, 0);

// åœ¨Activityçš„onActivityResultæ–¹æ³•ä¸­å»è¯»å–ä¿å­˜çš„æ–‡ä»¶
```
### è¿›å…¥æ‰‹æœºçš„æ— çº¿ç½‘ç»œè®¾ç½®é¡µé¢
```kotlin
// è¿›å…¥æ— çº¿ç½‘ç»œè®¾ç½®ç•Œé¢ï¼ˆå…¶å®ƒå¯ä»¥ä¸¾ä¸€åä¸‰ï¼‰  
Intent intent = new Intent(android.provider.Settings.ACTION_WIRELESS_SETTINGS);  
startActivityForResult(intent, 0);
```
## Activityå››ç§å¯åŠ¨æ¨¡å¼
### standard
é»˜è®¤å€¼ï¼Œå¤šå®ä¾‹æ¨¡å¼ã€‚æ¯å¯åŠ¨ä¸€æ¬¡ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Activityå®ä¾‹ã€‚
å¯åŠ¨çš„ç”Ÿå‘½å‘¨æœŸä¸ºï¼šonCreate()->onStart()->onResume()
### singleTop
æ ˆé¡¶å¤ç”¨æ¨¡å¼
å¦‚æœä»»åŠ¡æ ˆé¡¶å·²ç»å­˜åœ¨éœ€è¦å¯åŠ¨çš„ç›®æ ‡Activityï¼Œåˆ™ç›´æ¥å¯åŠ¨ï¼Œå¹¶ä¼šå›è°ƒonNewIntent()æ–¹æ³•ï¼Œç”Ÿå‘½å‘¨æœŸé¡ºåºä¸ºï¼š onPause() ->onNewIntent()->onResume()
å¦‚æœä»»åŠ¡æ ˆä¸Šé¡¶æ²¡æœ‰éœ€è¦å¯åŠ¨çš„ç›®æ ‡Activityï¼Œåˆ™åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œæ­¤æ—¶ç”Ÿå‘½å‘¨æœŸé¡ºåºä¸ºï¼š onCreate()->onStart()->onResume()
### singleTask
æ ˆå†…å¤ç”¨æ¨¡å¼ï¼Œä¸€ä¸ªä»»åŠ¡æ ˆåªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚
- æœ‰å‡ ç§æƒ…å†µï¼š
+ å½“å¯åŠ¨çš„Activityç›®æ ‡ä»»åŠ¡æ ˆä¸å­˜åœ¨æ—¶ï¼Œåˆ™ä»¥æ­¤å¯åŠ¨Activityä¸ºæ ¹Activityåˆ›å»ºç›®æ ‡ä»»åŠ¡æ ˆï¼Œå¹¶åˆ‡æ¢åˆ°å‰é¢
+ å½“å¯åŠ¨çš„Activityå­˜åœ¨æ—¶ï¼Œåˆ™ä¼šç›´æ¥åˆ‡æ¢åˆ°Activityæ‰€åœ¨çš„ä»»åŠ¡æ ˆï¼Œå¹¶ä¸”ä»»åŠ¡æ ˆä¸­åœ¨Activityä¸Šé¢çš„æ‰€æœ‰å…¶ä»–Activityéƒ½å‡ºæ ˆï¼ˆè°ƒç”¨destroy()ï¼‰ï¼Œæ­¤æ—¶å¯åŠ¨çš„Activityä½äºä»»åŠ¡æ ˆé¡¶ï¼Œå¹¶ä¸”ä¼šå›è°ƒonNewIntent()æ–¹æ³•ã€‚
### singleInstance
singleInstanceåç§°æ˜¯å•ä¾‹æ¨¡å¼ï¼Œå³Appè¿è¡Œæ—¶ï¼Œè¯¥Activityåªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚æ—¢ç„¶åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆä¹Ÿå°±è¯´æ˜å¾ˆé‡è¦ã€å¾ˆç‰¹æ®Šï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶â€œä¿æŠ¤èµ·æ¥â€ã€‚å•ä¾‹æ¨¡å¼çš„â€œä¿æŠ¤æªæ–½â€æ˜¯å°†å…¶å•ç‹¬æ”¾åˆ°ä¸€ä¸ªä»»åŠ¡æ ˆä¸­ã€‚

## Intent FLagè®¾å®šå¯åŠ¨æ¨¡å¼
é™¤äº†å¯ä»¥åœ¨manifestä¸­è®¾ç½®Activityçš„å¯åŠ¨æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®Intentçš„flagæ ‡è¯†æ¥è®¾å®šActivityçš„å¯åŠ¨æ¨¡å¼ã€‚
å¸¸ç”¨çš„æœ‰ï¼šFLAG_ACTIVITY_NEW_TASKï¼ŒFLAG_ACTIVITY_SINGLE_TOPï¼ŒFLAG_ACTIVITY_CLEAR_TOP
- FLAG_ACTIVITY_NEW_TASK
+ å¯åŠ¨Activityæ—¶ï¼Œå¦‚æœä¸å­˜åœ¨Activityçš„å®ä¾‹ï¼Œåˆ™ä¼šä»¥æ­¤Activityä¸ºæ ¹Activityåˆ›å»ºæ–°çš„ä»»åŠ¡æ ˆï¼Œå¦‚æœå­˜åœ¨çš„è¯åˆ™ç›´æ¥åˆ‡æ¢åˆ°å¯¹åº”çš„Activityå®ä¾‹ï¼Œå¹¶å›è°ƒonNewIntent()æ–¹æ³•ã€‚ç›¸å½“äºâ€œsingleTaskâ€å¯åŠ¨æ¨¡å¼ã€‚

- FLAG_ACTIVITY_SINGLE_TOP
+ ç›¸å½“äºâ€œsingleTopâ€æ¨¡å¼

- FLAG_ACTIVITY_CLEAR_TOP
+ è®¾ç½®æ­¤æ ‡è¯†çš„Activityåœ¨å¯åŠ¨æ—¶ï¼Œå¦‚æœå½“å‰çš„ä»»åŠ¡æ ˆå†…å­˜åœ¨æ­¤Activityå®ä¾‹ï¼Œåˆ™è·³è½¬åˆ°æ­¤å®ä¾‹ï¼Œå¹¶æ¸…é™¤æ‰åœ¨æ­¤å®ä¾‹ä¸Šé¢çš„æ‰€æœ‰Activityå®ä¾‹ï¼Œæ­¤æ—¶æ­¤Activityå®ä¾‹ä½äºä»»åŠ¡æ ˆçš„æ ˆé¡¶

## Fragment
Fragmentå¹¶ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œä»–éœ€è¦åµŒå¥—åœ¨Activity ä¸­ä½¿ç”¨ï¼Œå°½ç®¡ä»–æ‹¥æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šå—åˆ°å®¿ä¸»Activityçš„ç”Ÿå‘½å‘¨æœŸçš„å½±å“ï¼Œæ¯”å¦‚Activity è¢«destoryé”€æ¯äº†ï¼Œä»–ä¹Ÿä¼šè·Ÿç€é”€æ¯ï¼ä¸€ä¸ªActivityå¯ä»¥åµŒå¥—å¤šä¸ªFragmentã€‚
![fragment_lifecycle](./imgs/fragment_lifecycle.jpeg)
- ActivityåŠ è½½Fragmentçš„æ—¶å€™,ä¾æ¬¡è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•: onAttach -> onCreate -> onCreateView -> onActivityCreated -> onStart ->onResume
- å½“æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæ–°çš„é¡µé¢, æ­¤æ—¶Fragmentæ‰€åœ¨çš„Activityä¸å¯è§ï¼Œä¼šæ‰§è¡Œ onPause
- å½“æ–°é¡µé¢è¿”å›åï¼Œå½“å‰Activityå’ŒFragmentåˆå¯è§äº†ï¼Œä¼šå†æ¬¡æ‰§è¡ŒonStartå’Œ onResume
- é€€å‡ºäº†Activityçš„è¯,é‚£ä¹ˆFragmentå°†ä¼šè¢«å®Œå…¨ç»“æŸ, Fragmentä¼šè¿›å…¥é”€æ¯çŠ¶æ€ onPause -> onStop -> onDestoryView -> onDestory -> onDetach
### åŠ¨æ€æ·»åŠ Fragment
```kotlin
// å®šä¹‰StudyFragmentéœ€è¦ç»§æ‰¿è‡ªFragmentï¼Œå¹¶ä¸”ç»‘å®šå¸ƒå±€æ–‡ä»¶
class StudyFragment : Fragment(R.layout.fragment_study,container) {

}   

// åœ¨Activityä¸­ä½¿ç”¨supportFragmentManagerç®¡ç†Fragment,æ·»åŠ åˆ°ç•Œé¢ä¸Š
class MainActivity:AppCompactActivity{
   override fun onCreate(savedInstanceState: Bundle?) {
        val studyFragment =  StudyFragment();
        val bundle = Bundle()
        bundle.putInt()
        studyFragment.argments= Bundle
        supportFragmentManager.beginTransaction()
           .add(R.id.container, studyFragment).commitAllowingStateLoss()
   }
}
```
### Fragmentå¸¸è§çš„æ“ä½œ
```kotlin
val fragment = StudyFragment()
val ft = supportFragmentManager.beginTransaction()

if(!fragment.isAdded()){
  ft.add(R.id.container,fragment) //æŠŠfragmentæ·»åŠ åˆ°äº‹åŠ¡ä¸­ï¼Œå½“ä¸”ä»…å½“è¯¥fragmentæœªè¢«æ·»åŠ è¿‡
}
ft.show(fragment) //æ˜¾ç¤ºå‡ºfragmentçš„è§†å›¾
ft.hide(fragment) //éšè—fragment,ä½¿å¾—å®ƒçš„è§†å›¾ä¸å¯è§
ft.remove(fragment)//ç§»é™¤fragment
ft.replace(R.id.container,fragment)//æ›¿æ¢fragment,ä¹‹å‰æ·»åŠ è¿‡çš„fragmentéƒ½ä¼šè¢«æš‚æ—¶ç§»é™¤ï¼ŒæŠŠå½“å‰è¿™ä¸ªfragmentæ·»åŠ åˆ°äº‹åŠ¡ä¸­

ft.commitAllowingStateLoss()//æäº¤äº‹åŠ¡ï¼Œæ‰§è¡Œå¯¹fragmentçš„addã€replaceã€showã€hideæ“ä½œ
```
### ç»™Fragmentä¼ é€’æ•°æ®
```kotlin
class MainActivity:AppcompactActivity{

     override fun onCreate(savedInstanceState: Bundle?){

       val studyFragment =  StudyFragment();

       // åˆ›å»ºbundleå¯¹è±¡ã€å¹¶å¡«å……æ•°æ®èµ‹å€¼ç»™fragmentçš„argmentså­—æ®µ
       val bundle = Bundle()
       bundle.putInt("key_int",100)
       bundle.putString("key_string","key_string_value")
       studyFragment.argments= Bundle

       supportFragmentManager.beginTransaction().add(R.id.container,    studyFragment).commitAllowingStateLoss()

     }
}

class StudyFragment : Fragment(R.layout.fragment_study) {
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        // å–å‡ºå‚æ•°
        val intArgument = argments?.getInt("key_int")
        val stringArgument = argments?.getInt("key_string")
    }
}
```
# ServiceæœåŠ¡
> ä¸éœ€è¦å’Œç”¨æˆ·äº¤äº’ï¼Œè´Ÿè´£åå°ä»»åŠ¡ï¼Œæ¯”å¦‚æ’­æ”¾éŸ³ä¹ï¼Œsocketé•¿è¿æ¥
> Serviceå¯åŠ¨åé»˜è®¤æ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­,åœ¨æ‰§è¡Œå…·ä½“è€—æ—¶ä»»åŠ¡è¿‡ç¨‹ä¸­è¦æ‰‹åŠ¨å¼€å¯å­çº¿ç¨‹,åº”ç”¨ç¨‹åºè¿›ç¨‹è¢«æ€æ­»,æ‰€æœ‰ä¾èµ–è¯¥è¿›ç¨‹çš„ServiceæœåŠ¡ä¹Ÿä¼šåœæ­¢è¿è¡Œã€‚
> Serviceæ˜¯å››å¤§ç»„ä»¶ä¹‹ä¸€ï¼ŒåŒæ ·éœ€è¦åœ¨AndroidManifestä¸­æ³¨å†Œåï¼Œæ‰èƒ½ä½¿ç”¨.
[Servcieå¿…çŸ¥å¿…ä¼š.png](./imgs/Servcieå¿…çŸ¥å¿…ä¼š.png)
[service.jpeg](./imgs/service.jpeg)

### æ™®é€šå¯åŠ¨startService()
- â‘ é¦–æ¬¡å¯åŠ¨ä¼šåˆ›å»ºä¸€ä¸ªServiceå®ä¾‹,ä¾æ¬¡è°ƒç”¨onCreate()å’ŒonStartCommand()æ–¹æ³•,æ­¤æ—¶Service è¿›å…¥è¿è¡ŒçŠ¶æ€

- â‘¡å¦‚æœå†æ¬¡è°ƒç”¨StartServiceå¯åŠ¨Service,å°†ä¸ä¼šå†åˆ›å»ºæ–°çš„Serviceå¯¹è±¡, ç³»ç»Ÿä¼šç›´æ¥å¤ç”¨å‰é¢åˆ›å»ºçš„Serviceå¯¹è±¡,è°ƒç”¨å®ƒçš„onStartCommand()æ–¹æ³•ï¼

- â‘¢è¿™æ ·çš„Serviceä¸å®ƒçš„è°ƒç”¨è€…æ— å¿…ç„¶çš„è”ç³»,å°±æ˜¯è¯´å½“è°ƒç”¨è€…ç»“æŸäº†è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ, ä½†æ˜¯åªè¦ä¸è°ƒç”¨stopService,é‚£ä¹ˆServiceè¿˜æ˜¯ä¼šç»§ç»­è¿è¡Œçš„!

- â‘£æ— è®ºå¯åŠ¨äº†å¤šå°‘æ¬¡Service,åªéœ€è°ƒç”¨ä¸€æ¬¡StopServiceå³å¯åœæ‰Service

#### å®šä¹‰ServiceæœåŠ¡
```kotlin
class TestService : Service() {
    private val TAG = "TestService1"

    //å¿…é¡»è¦å®ç°çš„æ–¹æ³•  
    override fun onBind(intent: Intent?): IBinder? {
        Log.e(TAG, "onBindæ–¹æ³•è¢«è°ƒç”¨!")
        return null
    }

    //Serviceè¢«åˆ›å»ºæ—¶è°ƒç”¨  
    override fun onCreate() {
        Log.e(TAG, "onCreateæ–¹æ³•è¢«è°ƒç”¨!")
        super.onCreate()
    }

    //Serviceè¢«å¯åŠ¨æ—¶è°ƒç”¨  
    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {
        Log.e(TAG, "onStartCommandæ–¹æ³•è¢«è°ƒç”¨!")
        return super.onStartCommand(intent, flags, startId)
    }

    //Serviceè¢«å…³é—­ä¹‹å‰å›è°ƒ  
    override fun onDestroy() {
        Log.e(TAG, "onDestoryæ–¹æ³•è¢«è°ƒç”¨!")
        super.onDestroy()
    }
}
```
#### AndroidManifest.xmlå®ŒæˆServiceæ³¨å†Œ
```xml
<application>
     <service android:name=".components.TestService1">        
     </service>
</application>
```
#### åœ¨Avtivityä¸­StartServiceå¯åŠ¨æœåŠ¡
```kotlin
val intent = Intent(this,TestService1::class.java);   
startService(intent);
```
### ç»‘å®šå¯åŠ¨bindService()
- â‘ å½“é¦–æ¬¡ä½¿ç”¨bindService()å¯åŠ¨ä¸€ä¸ªServiceæ—¶,ç³»ç»Ÿä¼šå®ä¾‹åŒ–ä¸€ä¸ªServiceå®ä¾‹,å¹¶è°ƒç”¨å…¶onCreate()å’ŒonBind()æ–¹æ³•,ç„¶åè°ƒç”¨è€…å°±å¯ä»¥é€šè¿‡è¿”å›çš„IBinderå¯¹è±¡å’ŒServiceè¿›è¡Œäº¤äº’äº†,æ­¤åå¦‚æœæˆ‘ä»¬å†æ¬¡ä½¿ç”¨bindServiceç»‘å®šService,ç³»ç»Ÿä¸ä¼šåˆ›å»ºæ–°çš„Seviceå®ä¾‹,ä¹Ÿä¸ä¼šå†è°ƒç”¨onBind()æ–¹æ³•,åªä¼šç›´æ¥æŠŠIBinderå¯¹è±¡è¿”å›ç»™è°ƒç”¨æ–¹

- â‘¡å¦‚æœæˆ‘ä»¬è§£é™¤ä¸æœåŠ¡çš„ç»‘å®š,åªéœ€è°ƒç”¨unbindService(),æ­¤æ—¶onUnbindå’ŒonDestoryæ–¹æ³•å°†ä¼šè¢«è°ƒç”¨

- â‘¢bindServiceå¯åŠ¨çš„ServiceæœåŠ¡æ˜¯ä¸è°ƒç”¨è€…(Activity)ç›¸äº’å…³è”çš„,å¯ä»¥ç†è§£ä¸º "ä¸€æ¡ç»³å­ä¸Šçš„èš‚èš±",è¦æ­»ä¸€èµ·æ­»,åœ¨bindServiceå,ä¸€æ—¦è°ƒç”¨è€…(Activity)é”€æ¯,é‚£ä¹ˆServiceä¹Ÿç«‹å³ç»ˆæ­¢
#### å®šä¹‰ServiceæœåŠ¡
```kotlin
class TestService2 : Service() {
    private val TAG = "TestService2"
    private var count = 0
    private var quit = false

    //å®šä¹‰onBinderæ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡  
    private val binder: MyBinder = MyBinder()

    inner class MyBinder : Binder() {
        fun getCount(): Int {
            return count
        }
    }

    //å¿…é¡»å®ç°çš„æ–¹æ³•,ç»‘å®šæ”¹Serviceæ—¶å›è°ƒè¯¥æ–¹æ³•  
    override fun onBind(intent: Intent?): IBinder {
        Log.e(TAG, "onBindæ–¹æ³•è¢«è°ƒç”¨!")
        return binder
    }

    //Serviceè¢«åˆ›å»ºæ—¶å›è°ƒ  
    override fun onCreate() {
        super.onCreate()
        Log.e(TAG, "onCreateæ–¹æ³•è¢«è°ƒç”¨!")
        //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹åŠ¨æ€åœ°ä¿®æ”¹countçš„å€¼  
        object : Thread() {
            override fun run() {
                while (!quit) {
                    try {
                        sleep(1000)
                    } catch (e: InterruptedException) {
                        e.printStackTrace()
                    }
                    count++
                }
            }
        }.start()
    }

    //Serviceæ–­å¼€è¿æ¥æ—¶å›è°ƒ  
    override fun onUnbind(intent: Intent?): Boolean {
        Log.i(TAG, "onUnbindæ–¹æ³•è¢«è°ƒç”¨!")
        return true
    }

    //Serviceè¢«å…³é—­å‰å›è°ƒ  
    override fun onDestroy() {
        super.onDestroy()
        quit = true
        Log.i(TAG, "onDestroyedæ–¹æ³•è¢«è°ƒç”¨!")
    }

    override fun onRebind(intent: Intent?) {
        Log.i(TAG, "onRebindæ–¹æ³•è¢«è°ƒç”¨!")
        super.onRebind(intent)
    }
}
```
#### AndroidManifest.xmlä¸­æ³¨å†ŒæœåŠ¡
```xml
<application>
     <service android:name=".components.TestService2">        
     </service>
</application>
```
#### åœ¨Activityä¸­bindServiceå¯åŠ¨æœåŠ¡
```kotlin
//ä¿æŒæ‰€å¯åŠ¨çš„Serviceçš„IBinderå¯¹è±¡,åŒæ—¶å®šä¹‰ä¸€ä¸ªServiceConnectionå¯¹è±¡
        val conn: ServiceConnection = object : ServiceConnection {
            //Activityä¸Serviceæ–­å¼€è¿æ¥æ—¶å›è°ƒè¯¥æ–¹æ³•
            override fun onServiceDisconnected(name: ComponentName) {
                println("------Service DisConnected-------")
            }

            //Activityä¸Serviceè¿æ¥æˆåŠŸæ—¶å›è°ƒè¯¥æ–¹æ³•
            override fun onServiceConnected(name: ComponentName, service: IBinder) {
                println("------Service Connected-------")
                binder = service as MyBinder
            }
        }

        // bindæœåŠ¡
        val intent = Intent(this,TestService::class.java)
        bindService(intent,conn,Context.BIND_AUTO_CREATE)
        start_service.setOnClickListener {
            // ä»æœåŠ¡è·å–æ•°æ®
            Log.e("TestService2","getCount:${binder?.getCount()}")
        }

        // åœæ­¢æŒ‰é’®
        stop_service.setOnClickListener {
            unbindService(conn)
        }
```
### Android 8.0åŠä»¥ä¸Šä¸å…è®¸åå°å¯åŠ¨ServiceæœåŠ¡
åœ¨ä¸€åŠ æ‰‹æœºä¸Šï¼Œç”¨æˆ·å‡çº§äº†æ–°ç‰ˆ8.0çš„ç³»ç»Ÿï¼Œç”¨æˆ·å°†appåˆ‡åˆ°åå°ï¼Œè¿‡ä¸€ä¼šå„¿å°±å¼¹å‡ºâ€œxxx app å·²åœæ­¢è¿è¡Œâ€çš„å¼¹çª—ã€‚
é€šè¿‡å®šä½åˆ†æï¼Œå‘ç°ä¸‹é¢ä¿©å‰ç½®æ¡ä»¶
8.0ç³»ç»Ÿæ€æœåŠ¡æ€çš„å¾ˆé¢‘ç¹
1. ä¸ºäº†ä¿æ´»ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¿©Serviceäº’ä¿çš„æ–¹å¼
2. é©¬ä¸Šè·‘äº†26çš„æ¨¡æ‹Ÿå™¨ï¼Œæœç„¶å¤ç°ï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š
```text
Process: com.example.firstapp, PID: 10510
    java.lang.IllegalStateException: Not allowed to start service Intent { cmp=com.example.firstapp/.components.TestService }: app is in background uid UidRecord{adece9d u0a77 LAST bg:+1m35s61ms idle procs:1 seq(0,0,0)}
        at android.app.ContextImpl.startServiceCommon(ContextImpl.java:1505)
        at android.app.ContextImpl.startService(ContextImpl.java:1461)
        at android.content.ContextWrapper.startService(ContextWrapper.java:644)
        at android.content.ContextWrapper.startService(ContextWrapper.java:644)
        at com.example.firstapp.components.TestServiceActivity$onCreate$1.run(TestServiceActivity.kt:26)
```
- Android 8.0 è¿˜å¯¹ç‰¹å®šå‡½æ•°åšå‡ºäº†ä»¥ä¸‹å˜æ›´ï¼š
 + å¦‚æœé’ˆå¯¹ Android 8.0 çš„åº”ç”¨å°è¯•åœ¨ä¸å…è®¸å…¶åˆ›å»ºåå°æœåŠ¡çš„æƒ…å†µä¸‹ä½¿ç”¨ startService() å‡½æ•°ï¼Œåˆ™è¯¥å‡½æ•°å°†å¼•å‘ä¸€ä¸ª IllegalStateExceptionã€‚
 + æ–°çš„ Context.startForegroundService() å‡½æ•°å°†å¯åŠ¨ä¸€ä¸ªå‰å°æœåŠ¡ã€‚ç°åœ¨ï¼Œå³ä½¿åº”ç”¨åœ¨åå°è¿è¡Œï¼Œç³»ç»Ÿä¹Ÿå…è®¸å…¶è°ƒç”¨ Context.startForegroundService()ã€‚ä¸è¿‡ï¼Œåº”ç”¨å¿…é¡»åœ¨åˆ›å»ºæœåŠ¡åçš„äº”ç§’å†…è°ƒç”¨è¯¥æœåŠ¡çš„ startForeground() å‡½æ•°ã€‚
- è§£å†³æ–¹æ³•å°±å¾ˆç®€å•äº†ï¼ŒæŠŠServiceäº’å¯çš„é€»è¾‘å—æ”¹ä¸ºï¼š
- AndroidManifest.xmlå£°æ˜æƒé™
```xml
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
```
- æœåŠ¡å¯åŠ¨å…¼å®¹å†™æ³•
```kotlin
if (Build.VERSION.SDK_INT >= 26) {
    context.startForegroundService(intent);
} else {
    // Pre-O behavior.
    context.startService(intent);
}


class TestService:Service(){
  // å‘é€ä¸€ä¸ªå‰å°é€šçŸ¥
  override fun onCreate(){
       val notification: Notification =Notification.Builder(applicationContext, "channel_id").build()
       startForeground( 1, notification)
  }
}
```
- åœ¨è¢«å¯åŠ¨çš„Serviceåˆ›å»ºæœåŠ¡åçš„äº”ç§’å†…è°ƒç”¨startForground(0, new Notification())ï¼Œå¦‚æœä¸è°ƒç”¨æˆ–è°ƒç”¨æ—¶é—´è¶…è¿‡5ç§’ä¼šæŠ›å‡ºä¸€ä¸ªANRã€‚
# BroadcastReceiverå¹¿æ’­æ¥æ”¶è€…
> è´Ÿè´£é¡µé¢é—´é€šä¿¡ï¼Œç³»ç»Ÿå’ŒAPPé€šä¿¡ï¼ŒAPPå’ŒAPPé€šä¿¡ï¼Œæ¯”å¦‚ç›‘å¬ç½‘ç»œè¿æ¥çŠ¶æ€å˜åŒ–ï¼Œå°±æ˜¯é€šè¿‡BroadcastReceiverå¹¿æ’­æ¥æ”¶è€…æ¥å®ç°çš„
> BroadcastReceiverå¹¿æ’­æ¥æ”¶è€…Androidå››å¤§ç»„ä»¶ä¹‹ä¸€ï¼Œæ˜¯Androidç³»ç»Ÿæä¾›çš„ä¸€ç§é€šè®¯æ–¹å¼ã€‚
## ä¸¤ç§å¹¿æ’­ç±»å‹
    æ ‡å‡†å¹¿æ’­ï¼šå‘å‡ºå¹¿æ’­åï¼Œè¯¥å¹¿æ’­äº‹ä»¶çš„æ¥æ”¶è€…ï¼Œå‡ ä¹ä¼šåœ¨åŒä¸€æ—¶åˆ»æ”¶åˆ°é€šçŸ¥ï¼Œéƒ½å¯ä»¥å“åº”æˆ–ä¸å“åº”è¯¥äº‹ä»¶
    æœ‰åºå¹¿æ’­ï¼šå‘å‡ºå¹¿æ’­åï¼ŒåŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶è€…èƒ½æ”¶åˆ°ã€ä¸€ä¸ªæ¥æ”¶è€…å¤„ç†å®Œåä¹‹åï¼Œå¯ä»¥é€‰æ‹©ç»§ç»­å‘ä¸‹ä¼ é€’ç»™å…¶å®ƒæ¥æ”¶è€…ï¼Œä¹Ÿå¯ä»¥æ‹¦æˆªæ‰å¹¿æ’­ã€‚[ä¸å¸¸ç”¨ã€ä¸æ¨èä½¿ç”¨äº†]
## ç›‘å¬ç³»ç»Ÿç½‘ç»œè¿æ¥å˜åŒ–
### å®šä¹‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶è€…
```kotlin
// ç›‘å¬ç½‘ç»œè¿æ¥çŠ¶æ€çš„å˜åŒ–ï¼Œå¹¶toastæç¤º
class TestBroadcastReceiver : BroadcastReceiver() {
    override fun onReceive(context: Context?, intent: Intent?) {
       if (intent?.action?.equals(ConnectivityManager.CONNECTIVITY_ACTION)==true){
            val connectivityManager:ConnectivityManager = context?.getSystemService(Context.CONNECTIVITY_SERVICE) as ConnectivityManager
            val info = connectivityManager.activeNetworkInfo
            if(info != null && info.isAvailable) {
                val typeName = info.typeName
                Toast.makeText(context,"å½“å‰ç½‘ç»œåç§°:${typeName}",Toast.LENGTH_LONG).show()
            } else {
                Toast.makeText(context,"å½“å‰æ— ç½‘ç»œè¿æ¥",Toast.LENGTH_LONG).show()
            }
        }
    }
}
```
### è¿è¡Œæ—¶åŠ¨æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶äº‹ä»¶
```kotlin
class TestBroadcastRecevierActivity :AppCompatActivity(){
    private lateinit var myReceiver: TestBroadcastReceiver

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        myReceiver = TestBroadcastReceiver()
        // åˆ›å»ºå¹¿æ’­è¿‡æ»¤å™¨ï¼ŒæŒ‡å®šåªæ¥æ”¶android.net.conn.CONNECTIVITY_CHANGEçš„å¹¿æ’­äº‹ä»¶
        val intentFilter = IntentFilter() 
        intentFilter.addAction(Intent.ACTION_CONFIGURATION_CHANGED)
        registerReceiver(myReceiver, intentFilter)
    }

    override fun onDestroy() {
        super.onDestroy()
        unregisterReceiver(myReceiver)   // å¿…é¡»è¦åœ¨onDestroyæ—¶åæ³¨å†Œï¼Œå¦åˆ™ä¼šå†…å­˜æ³„æ¼
    }
}
```
>ä¸è¦åœ¨æ”¶åˆ°å¹¿æ’­åè¿›è¡Œä»»ä½•è€—æ—¶æ“ä½œ,å› ä¸ºåœ¨å¹¿æ’­ä¸­æ˜¯ä¸å…è®¸å¼€è¾Ÿçº¿ç¨‹çš„, å½“onReceiver( )æ–¹æ³•è¿è¡Œè¾ƒé•¿æ—¶é—´(è¶…è¿‡10ç§’)è¿˜æ²¡æœ‰ç»“æŸçš„è¯,é‚£ä¹ˆç¨‹åºä¼šæŠ¥é”™(ANR), å¹¿æ’­æ›´å¤šçš„æ—¶å€™æ‰®æ¼”çš„æ˜¯ä¸€ä¸ªæ‰“å¼€å…¶ä»–ç»„ä»¶çš„è§’è‰²,æ¯”å¦‚å¯åŠ¨Service,Notificationæç¤º, Activityç­‰ï¼

### é™æ€æ³¨å†Œå¹¿æ’­
```xml
<!--AndroidManifest.xmlä¸­æ³¨å†Œå¹¿æ’­-->
<receiver android:name=".components.TestBroadcastReceiver">
     <intent-filter >
          <action android:name="android.net.conn.CONNECTIVITY_CHANGE"/>
     </intent-filter>
</receiver>
```
```text
Googleå®˜æ–¹å£°æ˜ï¼šBeginning with Android 8.0 (API level 26), the system imposes additional restrictions on manifest-declared receivers. If your app targets API level 26 or higher, you cannot use the manifest to declare a receiver for most implicit broadcasts (broadcasts that do not target your app specifically). å¤§æ¦‚æ„æ€å°±æ˜¯è¯´ï¼šä»android 8.0ï¼ˆAPI26ï¼‰å¼€å§‹ï¼Œå¯¹æ¸…å•æ–‡ä»¶ä¸­é™æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶è€…å¢åŠ äº†é™åˆ¶ï¼Œå»ºè®®å¤§å®¶ä¸è¦åœ¨æ¸…å•æ–‡ä»¶ä¸­é™æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶è€…ã€‚

å…¶å®è¯´ç™½ç‚¹ï¼šå°±æ˜¯å› ä¸ºåœ¨æ¸…å•æ–‡ä»¶ä¸­é™æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶è€…ï¼Œå®¹æ˜“è®©ä¸€äº›"ä¸æ³•åˆ†å­"è·å–ç”¨æˆ·çš„éšç§(å¦‚ï¼šç”µè¯ç›‘å¬ã€çŸ­ä¿¡ç›‘å¬ç­‰ç­‰)ï¼Œæ‰€ä»¥googleé™åˆ¶äº†é™æ€æ³¨å†Œï¼ˆAndroidåœ¨ä¿æŠ¤ç”¨æˆ·éšç§ä¸ŠåšæŒä¸æ‡ˆçš„åŠªåŠ›ç€...ä¹Ÿè®¸googleè¿˜è¦å…¶ä»–çš„è€ƒè™‘å§ã€‚å’±ä¹Ÿä¸çŸ¥é“...å’±ä¹Ÿä¸æ•¢é—®ğŸ˜ï¼‰
```
### è§£å†³é™æ€æ³¨å†Œå¹¿æ’­æ¥æ”¶è€…æ”¶ä¸åˆ°äº‹ä»¶çš„é—®é¢˜
```kotlin
//è™½ç„¶ä»Android8.0å¼€å§‹ï¼Œç³»ç»Ÿæ˜ç¡®é™åˆ¶äº†é™æ€å¹¿æ’­æ³¨å†Œå»ç›‘å¬ç³»ç»Ÿè¡Œä¸ºï¼Œä½†æ˜¯åº”ç”¨è‡ªå·±å®šä¹‰çš„çš„å¹¿æ’­äº‹ä»¶è¿˜æ˜¯å¯ä»¥ä½¿ç”¨é™æ€æ³¨å†Œçš„
val intent= Intent();
intent.action = "com.example.firstapp.TEST_BROADCAST_RECEVIER";

// ä¸‹é¢è¿™ä¸€è¡Œåœ¨Android 7.0åŠä»¥ä¸‹ç‰ˆæœ¬ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯Android 8.0æˆ–è€…æ›´é«˜ç‰ˆæœ¬ï¼Œå‘é€å¹¿æ’­çš„æ¡ä»¶æ›´åŠ ä¸¥è‹›ï¼Œå¿…é¡»æ·»åŠ è¿™ä¸€è¡Œå†…å®¹ã€‚
// åˆ›å»ºçš„ComponentNameå®ä¾‹åŒ–å¯¹è±¡æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬1ä¸ªå‚æ•°æ˜¯æŒ‡æ¥æ”¶å¹¿æ’­ç±»çš„åŒ…åï¼Œç¬¬2ä¸ªå‚æ•°æ˜¯æŒ‡æ¥æ”¶å¹¿æ’­ç±»çš„å®Œæ•´ç±»åã€‚
intent.component =ComponentName(packageName,"com.example.firstapp.component.TEST_BROADCAST_RECEVIER")

sendBroadcast(intent)
```
## å‘é€è‡ªå®šä¹‰äº‹ä»¶å¹¿æ’­
### å…¨å±€å‘é€å¹¿æ’­
```kotlin
//å…¨å±€å‘é€å¹¿æ’­ï¼Œå¦‚æœåˆ«äººå®¶Appä¹Ÿæ³¨å†Œäº†è¯¥äº‹ä»¶ç›‘å¬ï¼Œä¹Ÿèƒ½æ”¶åˆ°ï¼Œæ¯”è¾ƒä¸åˆç†ã€‚

sendBroadcast(new Intent("com.example.firstapp.component.TEST_BROADCAST_RECEVIER"));
```
### åº”ç”¨å†…å‘é€å¹¿æ’­
```kotlin
//Appåº”ç”¨å†…å¹¿æ’­å¯ç†è§£ä¸ºä¸€ç§å±€éƒ¨å¹¿æ’­ï¼Œå¹¿æ’­çš„å‘é€è€…å’Œæ¥æ”¶è€…éƒ½åŒå±äºä¸€ä¸ªAppã€‚
//ç›¸æ¯”äºå…¨å±€å¹¿æ’­ï¼ˆæ™®é€šå¹¿æ’­ï¼‰ï¼ŒAppåº”ç”¨å†…å¹¿æ’­ä¼˜åŠ¿ä½“ç°åœ¨ï¼šå®‰å…¨æ€§é«˜ & æ•ˆç‡é«˜
// ä½¿ç”¨LocalBroadcastManageræ¥æ³¨å†Œåº”ç”¨å†…å¹¿æ’­
LocalBroadcastManager.getInstance(this).registerReceiver(myReceiver, itFilter)

// ä½¿ç”¨LocalBroadcastManageræ¥å‘é€åº”ç”¨å†…å¹¿æ’­
LocalBroadcastManager.getInstance(this).sendBroadcast(intent)
```
## ç³»ç»Ÿå¹¿æ’­ï¼ˆSystem Broadcastï¼‰
    Androidä¸­å†…ç½®äº†å¤šä¸ªç³»ç»Ÿå¹¿æ’­ï¼šåªè¦æ¶‰åŠåˆ°æ‰‹æœºçš„åŸºæœ¬æ“ä½œï¼ˆå¦‚å¼€æœºã€ç½‘ç»œçŠ¶æ€å˜åŒ–ã€æ‹ç…§ç­‰ç­‰ï¼‰ï¼Œéƒ½ä¼šå‘å‡ºç›¸åº”çš„å¹¿æ’­
    æ¯ä¸ªå¹¿æ’­éƒ½æœ‰ç‰¹å®šçš„Intent - Filterï¼ˆåŒ…æ‹¬å…·ä½“çš„actionï¼‰ï¼ŒAndroidç³»ç»Ÿå¹¿æ’­actionå¦‚ä¸‹ï¼š
| ç³»ç»Ÿæ“ä½œ                                       | 	action                              |
|:-------------------------------------------|:-------------------------------------|
| ç›‘å¬ç½‘ç»œå˜åŒ–	                                    | android.net.conn.CONNECTIVITY_CHANGE |
| å…³é—­æˆ–æ‰“å¼€é£è¡Œæ¨¡å¼                                  | 	Intent.ACTION_AIRPLANE_MODE_CHANGED |
| å……ç”µæ—¶æˆ–ç”µé‡å‘ç”Ÿå˜åŒ–                                 | 	Intent.ACTION_BATTERY_CHANGED       |
| ç”µæ± ç”µé‡ä½                                      | 	Intent.ACTION_BATTERY_LOW           |
| ç”µæ± ç”µé‡å……è¶³ï¼ˆå³ä»ç”µé‡ä½å˜åŒ–åˆ°é¥±æ»¡æ—¶ä¼šå‘å‡ºå¹¿æ’­                    | 	Intent.ACTION_BATTERY_OKAY          |
| ç³»ç»Ÿå¯åŠ¨å®Œæˆå(ä»…å¹¿æ’­ä¸€æ¬¡)                             | 	Intent.ACTION_BOOT_COMPLETED        |
| æŒ‰ä¸‹ç…§ç›¸æ—¶çš„æ‹ç…§æŒ‰é”®(ç¡¬ä»¶æŒ‰é”®)æ—¶                          | 	Intent.ACTION_CAMERA_BUTTON         |
| å±å¹•é”å±                                       | 	Intent.ACTION_CLOSE_SYSTEM_DIALOGS  |
| è®¾å¤‡å½“å‰è®¾ç½®è¢«æ”¹å˜æ—¶(ç•Œé¢è¯­è¨€ã€è®¾å¤‡æ–¹å‘ç­‰)                     | 	Intent.ACTION_CONFIGURATION_CHANGED |
| æ’å…¥è€³æœºæ—¶                                      | 	Intent.ACTION_HEADSET_PLUG          |
| æœªæ­£ç¡®ç§»é™¤SDå¡ä½†å·²å–å‡ºæ¥æ—¶(æ­£ç¡®ç§»é™¤æ–¹æ³•:è®¾ç½®--SDå¡å’Œè®¾å¤‡å†…å­˜--å¸è½½SDå¡) | 	Intent.ACTION_MEDIA_BAD_REMOVAL     |
| æ’å…¥å¤–éƒ¨å‚¨å­˜è£…ç½®ï¼ˆå¦‚SDå¡ï¼‰                             | 	Intent.ACTION_MEDIA_CHECKING        |
| æˆåŠŸå®‰è£…APK                                    | 	Intent.ACTION_PACKAGE_ADDED         |
| æˆåŠŸåˆ é™¤APK                                    | 	Intent.ACTION_PACKAGE_REMOVED       |
| é‡å¯è®¾å¤‡                                       | 	Intent.ACTION_REBOOT                |
| å±å¹•è¢«å…³é—­                                      | 	Intent.ACTION_SCREEN_OFF            |
| å±å¹•è¢«æ‰“å¼€                                      | 	Intent.ACTION_SCREEN_ON             |
| å…³é—­ç³»ç»Ÿæ—¶                                      | 	Intent.ACTION_SHUTDOWN              |
| é‡å¯è®¾å¤‡                                       | 	Intent.ACTION_REBOOT                |
# ContentProviderå†…å®¹æä¾›è€…
> è´Ÿè´£æ•°æ®å­˜å–ï¼Œå¸¸ç”¨äºAPPè¿›æ•°æ®å…±äº«ï¼Œè·¨è¿›ç¨‹æ•°æ®å­˜å–ç­‰....æ¯”å¦‚è¯»å–ç›¸å†Œï¼Œè¯»å–è”ç³»äººï¼Œéƒ½æ˜¯ContentProvideræ¥å®ç°çš„
[ContentProvider](./imgs/ContentProvider.png)
## æƒé™ç”³è¯·
>ä»android6.0å¼€å§‹ï¼Œå‡¡æ˜¯æ¶‰åŠç”¨æˆ·éšç§çš„æƒé™(è¯»å†™çŸ­ä¿¡ï¼Œè¯»å†™è”ç³»äººï¼Œæ‹æ‘„ï¼Œå½•éŸ³ç­‰ç­‰)ï¼Œéƒ½éœ€è¦è¿è¡Œæ—¶ç”³è¯·ï¼Œå¼¹çª—æé†’ç”¨æˆ·æ˜¯å¦æˆæƒã€‚ç”¨æˆ·ä¸æˆæƒåˆ™æ— æ³•ç»§ç»­æ“ä½œï¼Œè€Œä¸”ä»Šå¹´å·¥ä¿¡éƒ¨å¯¹äºè¿è§„æ”¶é›†ï¼Œç”³è¯·ç”¨æˆ·æƒé™çš„APPæŸ¥çš„éå¸¸ä¸¥æ ¼ï¼Œä¸å®šæœŸæŠ½æŸ¥ï¼ŒæŠ½æŸ¥æœ‰é—®é¢˜çš„å¿…é¡»æŒ‰æœŸæ•´æ”¹ï¼Œå¦åˆ™å¼ºåˆ¶ä¸‹æ¶ã€‚
```xml
<!--é¦–å…ˆåœ¨AndroidManifest.xmlä¸­å£°æ˜è¯»å–çŸ­ä¿¡çš„æƒé™-->
<uses-permission android:name="android.permission.READ_CONTACTS"/>
```
>è¿è¡Œæ—¶åŠ¨æ€ç”³è¯·æƒé™ï¼Œè¯·æ±‚ç”¨æˆ·æˆæƒ
+ ActivityCompat.checkSelfPermission()ï¼šæ£€æŸ¥æƒé™æ˜¯å¦å·²æˆæƒï¼Œå¦‚æœæ²¡æˆæƒåˆ™éœ€è¦å‘ç”¨æˆ·ç”³è¯·
+ ActivityCompat.requestPermissions()ï¼šå‘èµ·æƒé™ç”³è¯·,ä¼šå¼¹å‡ºå¯¹è¯æ¡†
+ ActivityCompat.shouldShowRequestPermissionRationale(): æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»æ°¸ä¹…æ‹’ç»ï¼Œå¦‚æœç”¨æˆ·å·²æ°¸ä¹…æ‹’ç»æŸä¸ªæƒé™çš„ç”³è¯·ï¼Œå³ä¾¿å†è°ƒç”¨ActivityCompat.requestPermissionsï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šå¼¹æ¡†å‘ç”¨æˆ·ç”³è¯·äº†ã€‚æ­¤æ—¶éœ€è¦è‡ªå·±å¼¹å¯¹è¯æ¡†ï¼Œå¼•å¯¼ç”¨æˆ·å»å¼€å¯æˆæƒ
+ onRequestPermissionsResultï¼šå¤„ç†æƒé™æˆæƒçš„ç»“æœ
+ å®Œæ•´çš„æƒé™ç”³è¯·æ¡ˆä¾‹
```kotlin

class PermissionActivity : AppCompatActivity() {
override fun onCreate(savedInstanceState: Bundle?) {
super.onCreate(savedInstanceState)

        if (ActivityCompat.checkSelfPermission(this,
                android.Manifest.permission.READ_SMS
            ) != PackageManager.PERMISSION_GRANTED) {
            ActivityCompat.requestPermissions( this, arrayOf(android.Manifest.permission.READ_SMS),100)
        } else {
            // å¦‚æœå·²æˆæƒåˆ™å¯ä»¥ç›´æ¥è¯»å–é€šè®¯å½•äº†
            getContacts()
        }
    }


    override fun onRequestPermissionsResult(
        requestCode: Int,
        permissions: Array<out String>,
        grantResults: IntArray
    ) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults)
         // å¤„ç†æƒé™ç”³è¯·çš„ç»“æœ
        if (requestCode==100&&permissions[0]== android.Manifest.permission.READ_SMS){
            if (grantResults[0]==PackageManager.PERMISSION_GRANTED){
                 // å¦‚æœè¯·æ±‚ç»“æœæ˜¯æˆæƒäº†ï¼Œåˆ™å¯ä»¥ç»§ç»­æ“ä½œ
                 getContacts()
            }else{
                // å¦‚æœæœ¬æ¬¡ç”³è¯·æƒé™ï¼Œæœªå¾—åˆ°æˆæƒï¼Œåˆ™toastæç¤ºï¼Œç»ˆæ­¢è¯»å–çš„æ“ä½œã€‚
                Toast.makeText(this, "é€šè®¯å½•æƒé™è¢«æ‹’ç»ï¼Œæ— æ³•è¯»å–è”ç³»äºº", Toast.LENGTH_SHORT).show()
            }
        }
    }
}
```
### è¯»å–é€šè®¯å½•è”ç³»äºº
| è¡¨å                                         | 	è¯´æ˜        |
|:-------------------------------------------|:-----------|
| content://com.android.contacts/data/phones | è¯»å–è”ç³»äººçš„è¡¨çš„åå­— |

| å­—æ®µ	          | è¯´æ˜  |
|:-------------|:----|
| display_name | ç”¨æˆ·å |
| Data1        | æ‰‹æœºå· |
```kotlin
 fun getContacts() {
        //â‘ æŸ¥è¯¢raw_contactsè¡¨è·å¾—è”ç³»äººçš„id
        val resolver = contentResolver
        val uri =Uri.parse("content://com.android.contacts/data/phones")
        //æŸ¥è¯¢è”ç³»äººæ•°æ®
        val cursor = resolver.query(uri, null, null, null, null)!!
        while (cursor.moveToNext()) {
            //è·å–è”ç³»äººå§“å,æ‰‹æœºå·ç 
            val cName: String =
                cursor.getString(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME))
            val cNum: String =
                cursor.getString(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER))
            Log.e("ContentProvider", "å§“å:$cName")
            Log.e("ContentProvider", "å·ç :$cNum")
            Log.e("ContentProvider", "======================")
        }
        cursor.close()
    }
```
### é€šä¿¡å½•æ’å…¥è”ç³»äºº
+ AndroidManifest.xmlå£°æ˜æƒé™
```xml

<uses-permission android:name="android.permission.WRITE_CONTACTS"/>
```
+ æ’å…¥è”ç³»äºº

| è¡¨å                                               | è¯´æ˜           |
|:-------------------------------------------------|:-------------|
| content://com.android.contacts/data/data         | æ’å…¥è”ç³»äººçš„è¡¨çš„åå­—   |
| content://com.android.contacts/data/raw_contacts | æ’å…¥è”ç³»äººçš„åŸå§‹è¡¨çš„åå­— |

```kotlin
fun insertContact() {
        val values = ContentValues()
        /*
         * é¦–å…ˆå‘RawContacts.CONTENT_URIæ‰§è¡Œä¸€ä¸ªç©ºå€¼æ’å…¥ï¼Œç›®çš„æ˜¯è·å¾—ç³»ç»Ÿè¿”å›çš„rawContactId
         * è¿™æ—¶åé¢æ’å…¥dataè¡¨çš„æ•°æ®ï¼Œæ‰èƒ½ä½¿æ’å…¥çš„è”ç³»äººåœ¨é€šè®¯å½•é‡Œé¢å¯è§
         */
        val rawContactUri: Uri = contentResolver!!.insert(RawContacts.CONTENT_URI, values)!!
        val rawContactId = ContentUris.parseId(rawContactUri)

        //å¾€dataè¡¨é‡Œå†™å…¥å§“åæ•°æ®
        values.clear()
        values.put(ContactsContract.Data.RAW_CONTACT_ID, rawContactId)
        values.put(ContactsContract.Data.MIMETYPE, StructuredName.CONTENT_ITEM_TYPE) //å†…å®¹ç±»å‹
        values.put(StructuredName.GIVEN_NAME, "æå››")
        contentResolver.insert(ContactsContract.Data.CONTENT_URI, values)

        //å¾€dataè¡¨é‡Œå†™å…¥ç”µè¯æ•°æ®
        values.clear()
        values.put(ContactsContract.Data.RAW_CONTACT_ID, rawContactId)
        values.put(ContactsContract.Data.MIMETYPE, Phone.CONTENT_ITEM_TYPE)
        values.put(Phone.NUMBER, "13921009789")
        values.put(Phone.TYPE, Phone.TYPE_MOBILE)
        contentResolver.insert(ContactsContract.Data.CONTENT_URI, values)

        //å¾€dataè¡¨é‡Œå†™å…¥Emailçš„æ•°æ®
        values.clear()
        values.put(ContactsContract.Data.RAW_CONTACT_ID, rawContactId)
        values.put(ContactsContract.Data.MIMETYPE, Email.CONTENT_ITEM_TYPE)
        values.put(Email.DATA, "lisi@qq.com")
        values.put(Email.TYPE, Email.TYPE_WORK)
        contentResolver
            .insert(ContactsContract.Data.CONTENT_URI, values)
    }
```
### æ›´æ–°è”ç³»äººä¿¡æ¯
+ æ ¹æ®æ‰‹æœºå·è·å–è”ç³»äººåœ¨é€šè®¯å½•çš„contact_id
```kotlin
fun getContactIdByPhone(phone:Long): String {
        val uri =Uri.parse("content://com.android.contacts/data/phones/filter/$phone")
        val cursor = contentResolver.query(
            uri,
            arrayOf(ContactsContract.Data.CONTACT_ID),
            null,
            null,
            null
        )!! 
        if (cursor.moveToFirst()) {
            return cursor.getString(0)
        }
        return ""
    }
```
+ æ›´æ–°è”ç³»äººçš„å§“å
```kotlin
fun update(){
   val contact_id = getContactIdByPhone(100001)
   val values = ContentValues()
   values.put(ContactsContract.Data.MIMETYPE,
            ContactsContract.CommonDataKinds.StructuredName.CONTENT_ITEM_TYPE
        ) //å†…å®¹ç±»å‹
        values.put(ContactsContract.CommonDataKinds.StructuredName.GIVEN_NAME, "lisi")
        contentResolver.update(
            Uri.parse("content://com.android.contacts/data"),
            values,
            "${ContactsContract.Data.CONTACT_ID}=?",
            arrayOf(contact_id)
        )
}
```
### åˆ é™¤è”ç³»äºº
+ æ ¹æ®å§“ååˆ é™¤è”ç³»äºº
```kotlin
contentResolver.delete(RawContacts.CONTENT_URI,CommonDataKinds.Phone.DISPLAY_NAME+"=?", arrayOf("test"));
```
+ æ ¹æ®æ‰‹æœºå·åˆ é™¤è”ç³»äºº
```kotlin
val contact_id = getContactIdByPhone(1111)

contentResolver.delete(RawContacts.CONTENT_URI,CommonDataKinds.Phone.CONTACT_ID+"=?", arrayOf(contact_id));
```
### è¯»å–æ”¶ä»¶ç®±æ‰€æœ‰çŸ­ä¿¡
| å­—æ®µ        | 	è¯´æ˜                                   |
|:----------|:--------------------------------------|
| address	  | å‘ä»¶äººåœ°å€ï¼Œå³æ‰‹æœºå·ï¼Œå¦‚+8613811810000            |
| person	   | å‘ä»¶äººåœ°å€ï¼Œå³æ‰‹æœºå·ï¼Œå¦‚+8613811810000            |
| date	     | æ—¥æœŸï¼Œlongå‹ï¼Œå¦‚1256539465022ï¼Œå¯ä»¥å¯¹æ—¥æœŸæ˜¾ç¤ºæ ¼å¼è¿›è¡Œè®¾ç½® |
| protocol	 | åè®®0 ï¼šSMS_RPOTOçŸ­ä¿¡ï¼Œ1:MMS_PROTOå½©ä¿¡        |
| read	     | æ˜¯å¦é˜…è¯»0:æœªè¯»ï¼Œ1:å·²è¯»                         |
| type	     | çŸ­ä¿¡ç±»å‹1: æ¥æ”¶åˆ°çš„çŸ­ä¿¡ï¼Œ2:å‘å‡ºçš„çŸ­ä¿¡                 |
| body	     | çŸ­ä¿¡å…·ä½“å†…å®¹                                |
```kotlin
fun getMsgs() {
        val uri: Uri = Uri.parse("content://sms/")
        val resolver = contentResolver
        //è·å–çš„æ˜¯å“ªäº›åˆ—çš„ä¿¡æ¯
        val cursor: Cursor = resolver.query(
            uri,
            arrayOf("address", "date", "type", "body"),
            null,
            null,
            null
        )!!
        while (cursor.moveToNext()) {
            val address: String = cursor.getString(0)
            val date: String = cursor.getString(1)
            val type: String = cursor.getString(2)
            val body: String = cursor.getString(3)
            Log.e("ContentProvider", "åœ°å€:$address")
            Log.e("ContentProvider", "æ—¶é—´:$date")
            Log.e("ContentProvider", "ç±»å‹:$type")
            Log.e("ContentProvider", "å†…å®¹:$body")
            Log.e("ContentProvider", "======================")
        }
        cursor.close()
    }
```
```text
note: 
çŸ­ä¿¡ç›¸å…³çš„å…¶å®ƒæ“ä½œuri

content://sms/ æ‰€æœ‰çŸ­ä¿¡

content://sms/inbox æ”¶ä»¶ç®±

content://sms/sent å·²å‘é€

content://sms/draft è‰ç¨¿

content://sms/outbox å‘ä»¶ç®±

content://sms/failed å‘é€å¤±è´¥

content://sms/queued å¾…å‘é€åˆ—è¡¨
```